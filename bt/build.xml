<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<project name="Baseline Tailor" default="zip" basedir=".">
  <description>Ant build file for Baseline Tailor distribution</description>

  <taskdef name="xmltask" classname="com.oopsconsultancy.xmltask.ant.XmlTask"/>
  <taskdef name="schematron" classname="com.schematron.ant.SchematronTask"/>

  <!-- set global properties for this build -->
  <property name="build" location="BT"/>
  <property name="github" location="../../joshualubell.github.io/BT"/>
  <property name="SP800-53" location="../../standards/NIST/SP800-53/800-53-controls.xml"/>
  <property name="cybercore-exported" location="../../doc/2015Balisage/data/cyber.xml"/>
  
  <target name="init">
    <!-- Create the time stamp -->
    <tstamp/>
  </target>

  <target name="transform">
    <!-- run XSLTs to generate catalog, families, and cyberframework core instances -->
    <xslt in="${SP800-53}" out="families.xml" style="families.xsl"/>
    <xslt in="${SP800-53}" out="catalog.xml" style="catalog.xsl"/>
    <xslt in="${cybercore-exported}" out="core.xml" style="core.xsl"/>
    <xslt in="core.xml" out="subcategories.xml" style="subcategories.xsl"/>
    <xslt in="families.xml" out="xref.xml" style="xref.xsl"/>
  </target>
    
  <target name="copy" depends="init, transform, clean"
          description="generate the distribution">
    <xmltask source="bt.xml" todir="${build}"/>
    <copy todir="${build}" preservelastmodified="true">
      <fileset dir="." includes="styles.css core.xml subcategories.xml families.xml catalog.xml bt.xml matrix.xml xref.xml stylesheet.xsl stylesheet-profile.xsl images/** xsltforms/**"/>
    </copy>
  </target>

  <target name="sch" description="validate tailoring against a schematron schema">
    <schematron schema="${schema}" file="${file}"/>
  </target>

  <target name="zip" depends="copy" 
	  description="zip up the copied files">
    <zip destfile="${build}-${DSTAMP}.zip" basedir="." includes="BT/**"/>
  </target>

  <target name="clean"
          description="clean up">
    <!-- Delete the ${build} directory tree and any generated zip files -->
    <delete dir="${build}"/>
    <delete dir="." includes="BT-*.zip"/>
  </target>
</project>
