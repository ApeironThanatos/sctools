<?xml version="1.0" encoding="UTF-8"?>
<project name="gov.nist.scap.datastream"
    xmlns:if="ant:if"
    xmlns:unless="ant:unless">
    
    <target name="dita2sds" 
        depends="dita2sds.init, dita2sds.transform, dita2sds.scapval"/>
    
    <target name="dita2sds.init">
        
        <!-- Allows the XSLT to access files containing the SCAP components (XCCDF, OVAL, etc.). 
        Assumes these files are in the same directory as the input DITA map. -->
        <property name="temp.output.dir.name" value=""/>
        
        <property name="out.ext" value="xml"/>
        <condition property="DITA-OT-3">
            <matches string="${otrelease}" pattern="^3\.[0-9].*"/>
        </condition>
        <condition property="DITA-OT-2-5">
            <matches string="${otrelease}" pattern="^2\.5.*"/>
        </condition>
    </target>
    
    <target name="dita2sds.copy-components">
        <echo level="info">* DITA-OT release = ${otrelease}</echo> 
        <copy if:set="DITA-OT-3" todir="${dita.output.dir}">
            <ditafileset format="xml"/>
        </copy>
    </target>
    
    <target name="dita2sds.transform" depends="dita2sds.copy-components">
        <pipeline message="Convert DITA SCAP map to data stream collection format" taskname="xslt">
            <xslt basedir="${dita.output.dir}"
                destdir="${output.dir}"
                extension="${out.ext}"
                style=
                "${dita.plugin.gov.nist.scap.datastream.dir}${file.separator}xsl${file.separator}sds.xsl"
                filenameparameter="FILENAME"
                filedirparameter="FILEDIR"
                >
                <ditaFileset format="ditamap" processingRole="normal"/>
                <mapper if:set="DITA-OT-2-5" classname="org.dita.dost.util.JobMapper" to="${out.ext}"/>
                <xmlcatalog refid="dita.catalog"/>            
            </xslt>
        </pipeline>
    </target>
    
    <target name="dita2sds.scapval" depends="dita2sds.transform" if="args.scapvaljar">
        <echo level="info">Running NIST SCAP Content Validation Tool</echo>
        <pipeline message="Extracting @scap-version from source data stream collection" taskname="xslt">
            <xslt in="${out.ext}"
                out=""
                style="${dita.plugin.gov.nist.scap.datastream.dir}${file.separator}xsl${file.separator}xmlproperties.xsl"/>
        </pipeline>
        <xmlproperty file="${dita.output.dir}${file.separator}scapversion.xml"/>
        <java jar="${args.scapvaljar}" fork="true">
            <arg value="-file ${}"/>
            <arg value="-scapversion ${root.properties.scapversion}"/>
        </java>
    </target>
    
</project>
